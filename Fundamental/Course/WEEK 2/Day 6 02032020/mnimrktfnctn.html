<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script>
  
      let satu,ordr,bayar,total,totalcart,begin,optn,namaBaru,stockBaru,hargaBaru
     
      //nama item
      let buah= [
        {nama: "Anggur", stock: 20, harga:1, qty: 0},
        {nama: "Jeruk", stock: 15, harga:2, qty: 0},
        {nama: "Mangga", stock: 25, harga:3, qty: 0}]  
        mainMenu()
        alert("Thank You")

      // function zone
      function mainMenu(){
        let begin = (`MAIN-MENU 
          
          1. User  > Shop and Fun!

          2. Admin > Edit item, etc.
          3. Exit

          Masukan menu yang diinginkan`)
        optn = parseInt(prompt(begin))
        if (optn == 1){
            isiQty()      
            alert('BELANJA LAGI YA!!')
            mainMenu()}
        else if (optn == 2){   
            alert("Edit asik")
            adminEdit()
            mainMenu()} 
        else if (optn == 3)
            return
        else{
            alert('isinya ga sesuai, pilih sesuai option!')
            mainMenu()
        }
      }

      //function zone ADMIN
      function adminEdit(){
          namaBaru = prompt(`Nama buah baru?`)
          stockBaru = parseInt(prompt(`Jumlah stock buah baru?`))
          hargaBaru = parseInt(prompt(`Harga buah baru per-pcs?`))
    
          buah.push({nama: namaBaru, stock: stockBaru, harga: hargaBaru, qty: 0})
          console.log(buah)
          mainMenu()  
      }

      //function zone USER
      function isiQty(){
        let init = (`Toko TIGA buah ${'\n' + '\n'}`)
        for (let i=0; i<buah.length; i++)
        {init +=`${i+1}. ${buah[i].nama} ${buah[i].harga}/pcs|  |Stock: ${buah[i].stock} ${'\n'}`}
        init += `${'\n'}${buah.length+1} List Cart ${'\n'}` 
        init += `${buah.length+2} Check Out `
        ordr = parseInt(prompt(init))
        checkQty(ordr)
      }
          
      function checkQty(ordr){
        if (ordr < 0){
            alert("gaboleh negatif / lebih dari stock, isi ulang!")
            isiQty()} 
        else if (ordr <= buah.length){
            satu = parseInt(prompt(buah[ordr-1].nama +' '+ buah[ordr-1].harga + "/pcs" + "Stock tersedia: " + buah[ordr-1].stock))
            if (satu < 0 || satu > buah[ordr-1].stock[ordr-1]){
              alert('Masukan total bilangan bulat, dan sesuai stock!')}
            else{
            buah[ordr-1].qty +=parseInt(satu)
            buah[ordr-1].stock -=parseInt(satu)
            isiQty()}
        }             
        else if (ordr == buah.length+2){
            total = 0
            for (let i=0; i<buah.length; i++){
              total += (parseInt(buah[i].qty*buah[i].harga))}
              shopCountPay(total)
              blen()                 
        }
        else if (ordr == buah.length+1){
            shopCart(buah.length)}
        else {
            alert("isinya ga sesuai!")
            checkQty()
        }
      }

      function shopCart(index1)
      {
        let carts =`ISI KERANJANG \n`
            totalcart=0
            for (let i=0; i<index1; i++)
                {totalcart += (parseInt(buah[i].qty*buah[i].harga))
                if(buah[i].qty > 0){
                    carts +=`${buah[i].nama} => ${buah[i].qty} Total = ${buah[i].qty*buah[i].harga}\n`}}
            carts +=`\n Total Belanjaan ${totalcart}`
            alert(carts)
            isiQty()
      }      

      function shopCountPay(total){
        bayar = parseInt(prompt("Total belanjaan = " + total + " masukan uang anda"))
        shopPaymentOpt(bayar,total)
      }

      function shopPaymentOpt(bayar, total){
        if (bayar < total) {
            alert("Uangnya kurang " + (total - bayar) + " input ulang uang-nya")
            shopCountPay(total)}
        else if (bayar > total){
            alert("Kembalianya " + (bayar - total) +  ". ikhlasin ya :)")}
        else if (bayar == total){
            alert("Terimakasih, uangnya pas")}
        else{
            alert("bayar-nya ga sesuai, input" + total)
            shopCountPay(total)
        }
      }

      function blen(){
        let blen = confirm("Jajan lagi?")
        if (blen == true){
             //stock item update
            for (let i=1; i<buah.length; i++)
                {buah[i].qty = 0}
                isiQty()
            }
        else{
            alert("end of isiQty > now go to main menu")
            mainMenu()} 
      }   
    </script>
  </body>
</html>
